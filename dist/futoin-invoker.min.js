!function(a){"function"==typeof define&&define.amd?define(["futoin-asyncsteps","lodash"],a):"object"==typeof exports?module.exports=a(require("futoin-asyncsteps"),require("lodash")):this.FutoInInvoker=a($as,_)}(function(a,b){function c(a){var b=c.cache[a];if(!b){var d={};b=c.cache[a]={id:a,exports:d},c.modules[a].call(d,b,d)}return b.exports}var d,e=this;return c.cache=[],c.modules=[function(a,b){"use strict";function d(a){a=a||{};var b=a[h.OPT_SPEC_DIRS]||[];b instanceof Array||(b=[b]),a[h.OPT_SPEC_DIRS]=b,i.SimpleCCMImpl.call(this,a)}var e=c(7),f=c(3),g=f.FutoInError,h=f.Options,i=c(6);b=a.exports=function(b){return new a.exports.AdvancedCCMImpl(b)},d.prototype={onRegister:function(a,b){e.loadSpec(a,b,this.options[h.OPT_SPEC_DIRS]),this.options[h.OPT_PROD_MODE]||e.checkConsistency(a,b)},checkParams:function(a,b,c){var d,f=b.info,h=b.name;"SecureChannel"in f.constraints&&!f.secure_channel&&a.error(g.SecurityError,"Requires secure channel"),"AllowAnonymous"in f.constraints||f.creds||a.error(g.SecurityError,"Requires authenticated user"),h in f.funcs||a.error(g.InvokerError,"Unknown interface function");var i=f.funcs[h];b.upload_data&&!i.rawupload&&a.error(g.InvokerError,"Raw upload is not allowed"),!Object.keys(i.params).length&&Object.keys(c).length&&a.error(g.InvokerError,"No params are defined");for(d in c)i.params.hasOwnProperty(d)||a.error(g.InvokerError,"Unknown parameter "+d),e.checkParameterType(a,f,d,i.params[d].type,c[d]);for(d in i.params)c.hasOwnProperty(d)||i.params[d].hasOwnProperty("default")||a.error(g.InvokerError,"Missing parameter "+d)},createMessage:function(a,b,c){this.options[h.OPT_PROD_MODE]||this.checkParams(a,b,c);var d=b.info,e={f:d.iface+":"+d.version+":"+b.name,p:c};null!==d.creds&&("master"===d.creds||(e.sec=d.creds)),b.expect_response=d.funcs[b.name].expect_result,a.success(e)},onMessageResponse:function(a,b,c){var d=b.info,f=d.funcs[b.name];if("e"in c){var h=c.e;h in f["throws"]||h in e.standard_errors?a.error(h,c.edesc):a.error(g.InternalError,"Not expected exception from Executor")}f.rawresult&&a.error(g.InternalError,"Raw result is expected"),"master"===d.creds;var i=f.result,j=Object.keys(i).length;for(var k in c.r)i.hasOwnProperty(k)&&(e.checkResultType(a,d,k,i[k].type,c.r[k]),--j);j>0&&a.error(g.InternalError,"Missing result variables"),a.success(c.r)},onDataResponse:function(a,b,c){b.info.funcs[b.name].rawresult?a.success(c):a.error(g.InternalError,"Raw result is not expected")},perfomHTTP:i.SimpleCCMImpl.prototype.perfomHTTP,perfomWebSocket:i.SimpleCCMImpl.prototype.perfomWebSocket,perfomUNIX:i.SimpleCCMImpl.prototype.perfomUNIX},b.AdvancedCCMImpl=d},function(a){!function(b){"use strict";var d=b.FutoIn||{};if("undefined"==typeof d.Invoker){var e=c(4),f=e.SimpleCCM;b.SimpleCCM=f;var g=e.AdvancedCCM;b.AdvancedCCM=g,d.Invoker=e,b.FutoInInvoker=e,b.FutoIn=d,a&&(a.exports=e)}}(window)},function(a,b){"use strict";var d=c(11),e=c(3),f=e.FutoInError,g=e.Options,h=WebSocket;b.HTTPComms=function(){},b.HTTPComms.prototype={perform:function(a,b,c){var d=this;a.add(function(a){d._perform(a,b,c)})},_perform:function(a,b,c){var d,e=new XMLHttpRequest,g=b.endpoint,h=b.upload_data;if(h||""===h){d="application/octet-stream","/"!==g.charAt(g.length-1)&&(g+="/"),g+=c.f.replace(/:/g,"/")+"/","sec"in c&&(g+=c.sec+"/");var i=[];for(var j in c.p)i.push(encodeURIComponent(j)+"="+encodeURIComponent(c.p[j]));g+="?"+i.join("&")}else d="application/futoin+json",h=JSON.stringify(c);b.expect_response&&(b.download_stream&&(e.responseType=b.download_stream),e.onreadystatechange=function(){if(this.readyState===this.DONE){var c=b.download_stream?this.response:this.responseText;if(c)a.success(c,this.getResponseHeader("content-type"));else try{a.error(f.CommError,"Low error")}catch(d){}}},a.setCancel(function(){e.abort()})),e.open("POST",g,!0),e.setRequestHeader("Content-Type",d),e.send(h),b.expect_response||a.success()}},b.WSComms=function(){this.rid=1,this.reqas={},this.evt=new d},b.WSComms.prototype={_waiting_open:!1,init:function(a,b){var c={},d=b.options[g.OPT_COMM_CONFIG_CB];d&&d(b.endpoint.match(/^(wss?)/)[1],c);var e=new h(b.endpoint);this.ws=e,this._waiting_open=!0;var i=this.reqas,j=c.futoin_executor,k=b.info,l=this,m=function(a){e.send(JSON.stringify(a))},n=function(a){e.close(),delete l.ws;for(var b in i)try{i[b].error(f.CommError,a.wasClean?"Cleanup":"Error")}catch(c){}delete l.reqas,l.reqas={},l._waiting_open=!1};e.onclose=n,e.onerror=n,e.onopen=function(a){l._waiting_open=!1,l.evt.emit("open")},e.onmessage=function(a){var b;try{b=JSON.parse(a.data)}catch(c){return}if("rid"in b){var d=b.rid;d in i?(i[d].success(b,"application/futoin+json"),delete i[d]):"S"===d.charAt(0)&&j&&j.onEndpointRequest(k,b,m)}}},perform:function(a,b,c){var d=this;"ws"in this||d.init(a,b),this._waiting_open&&a.add(function(a){if(d._waiting_open){var b=function(){a.success()};d.evt.once("open",b),a.setCancel(function(){d.evt.removeListener("open",b)})}}),a.add(function(a){d._perform(a,b,c)})},_perform:function(a,b,c){var d=this.reqas,e="C"+this.rid++;b.expect_response&&(d[e]=a,a.setCancel(function(){delete d[e]})),c.rid=e,this.ws.send(JSON.stringify(c))}}},function(a,b){"use strict";var d=c(9);b.AsyncSteps=d,b.FutoInError=d.FutoInError,b.Options={OPT_CALL_TIMEOUT_MS:"CALL_TIMEOUT_MS",OPT_X509_VERIFY:"X509_VERIFY",OPT_PROD_MODE:"PROD_MODE",OPT_COMM_CONFIG_CB:"COMM_CONFIG_CB",OPT_SPEC_DIRS:"SPEC_DIRS"},b._ifacever_pattern=/^(([a-z][a-z0-9]*)(\.[a-z][a-z0-9]*)*):(([0-9]+)\.([0-9]+))$/},function(a,b){"use strict";function d(a){this._iface_info={},this._iface_impl={},this._impl=j(a)}function e(a){this._iface_info={},this._iface_impl={},this._impl=k(a)}var f=c(3),g=f.FutoInError,h=c(5),i=c(10),j=c(6),k=c(0),l=c(7),m={SVC_RESOLVER:"#resolver",SVC_AUTH:"#auth",SVC_DEFENSE:"#defense",SVC_ACL:"#acl",SVC_LOG:"#log",SVC_CACHE_L1:"#cachel1",SVC_CACHE_L2:"#cachel2",SVC_CACHE_L3:"#cachel3"};i.extend(m,f.Options),i.extend(d,m);var n={SVC_RESOLVER:"#resolver",SVC_AUTH:"#auth",SVC_DEFENSE:"#defense",SVC_ACL:"#acl",SVC_LOG:"#log",SVC_CACHE_L1:"#cachel1",SVC_CACHE_L2:"#cachel2",SVC_CACHE_L3:"#cachel3",_secure_replace:/^secure\+/,_secure_test:/^(https|wss|unix):\/\//,_native_iface_builder:function(a,b){return h(a,b)}};i.extend(n,m),n.register=function(a,b,c,d,e,h){b in this._iface_info&&a.error(g.InvokerError,"Already registered");var j=c.match(f._ifacever_pattern);null===j&&a.error(g.InvokerError,"Invalid ifacever");var k=j[1],l=j[4],m=j[5],n=j[6],o=!1,p=null;"string"==typeof d?(this._secure_replace.test(d)?(o=!0,d=d.replace(this._secure_replace,"")):this._secure_test.test(d)&&(o=!0),p=this._native_iface_builder):(p=d,d=null),h=h||{},i.defaults(h,this._impl.options);var q={iface:k,version:l,mjrver:m,mnrver:n,endpoint:d,creds:e||null,secure_channel:o,impl:p,regname:b,inherits:null,funcs:null,constraints:null,options:h,_invoker_use:!0};this._iface_info[b]=q,this._impl.onRegister(a,q)},n.iface=function(a){var b=this._iface_info[a];if(!b)throw new Error(g.InvokerError);var c=b.regname,d=this._iface_impl[c];return d||(d=b.impl(this._impl,b),this._iface_impl[c]=d),d},n.unRegister=function(a){var b=this._iface_info[a];if(!b)throw new Error(g.InvokerError);var c=b.regname;if(c===a){if(delete this._iface_info[c],delete this._iface_impl[c],b.aliases)for(var d=b.aliases,e=0;e<d.length;++e)delete this._iface_info[d[e]]}else delete this._iface_info[a],b.aliases.splice(b.aliases.indexOf(a),0)},n.defense=function(){return this.iface(this.SVC_DEFENSE)},n.log=function(){return this.iface(this.SVC_LOG)},n.burst=function(){throw new Error(g.NotImplemented)},n.cache_l1=function(){return this.iface(this.SVC_CACHE_L1)},n.cache_l2=function(){return this.iface(this.SVC_CACHE_L2)},n.cache_l3=function(){return this.iface(this.SVC_CACHE_L3)},n.assertIface=function(a,b){var c=this._iface_info[a];if(!c)throw new Error(g.InvokerError);var d=b.match(f._ifacever_pattern);if(null===d)throw new Error(g.InvokerError);var e=d[1],h=d[5],i=d[6];if(c.iface!==e||c.mjrver!==h||c.mnrver<i)throw new Error(g.InvokerError)},n.alias=function(a,b){var c=this._iface_info[a];if(!c||this._iface_info[b])throw new Error(g.InvokerError);this._iface_info[b]=c,c.aliases?c.aliases.push(b):c.aliases=[b]},d.prototype=n,i.extend(e,m);var o={};i.extend(o,n),o.initFromCache=function(a,b){a.error(g.NotImplemented,"Caching is not supported yet")},o.cacheInit=function(a){},e.prototype=o,b.SimpleCCM=d,b.AdvancedCCM=e,b.FutoInError=g,b.NativeIface=h.NativeIface,b.InterfaceInfo=h.InterfaceInfo,b.SpecTools=l,b.SpecTools._ifacever_pattern=f._ifacever_pattern},function(a,b){"use strict";function d(a){this._raw_info=a}function e(a,b){this._ccmimpl=a,this._raw_info=b,this._iface_info=null;for(var c in this._raw_info.funcs){var d=this._raw_info.funcs[c];d.rawupload||c in this||(this[c]=this._member_call_generate(c,d))}}var f=c(4),g=c(10);b=a.exports=function(b,c){return new a.exports.NativeIface(b,c)},d.prototype={name:function(){return this._raw_info.iface},version:function(){return this._raw_info.version},inherits:function(){return this._raw_info.inherits},funcs:function(){return this._raw_info.funcs},constraints:function(){return this._raw_info.constraints}},b.InterfaceInfo=d,e.prototype={call:function(a,b,c,d,e,g){c=c||{};var h={ccmimpl:this._ccmimpl,name:b,info:this._raw_info,upload_data:d,download_stream:e,rsp_content_type:null,native_iface:this,options:this._raw_info.options,endpoint:this._raw_info.endpoint,expect_response:!0},i=this._ccmimpl;a.add(function(a){i.createMessage(a,h,c)}),a.add(function(a,c){"number"!=typeof g&&(g=h.info.options[f.SimpleCCM.OPT_CALL_TIMEOUT_MS]),g>0&&a.setTimeout(g);var d=h.endpoint.split(":")[0];if("http"===d||"https"===d)i.perfomHTTP(a,h,c);else if("ws"===d||"wss"===d){var e;h.upload_data||h.download_stream||h.info.funcs&&(e=h.info.funcs[b])&&e.rawresult?(h.endpoint=h.endpoint.replace("ws","http"),i.perfomHTTP(a,h,c)):i.perfomWebSocket(a,h,c)}else h.upload_data?a.error(f.FutoInError.InvokerError,"Upload data is allowed only for HTTP/WS endpoints"):h.download_stream?a.error(f.FutoInError.InvokerError,"Download stream is allowed only for HTTP/WS endpoints"):"unix"===d?i.perfomUNIX(a,h,c):a.error(f.FutoInError.InvokerError,"Unknown endpoint schema");a.add(function(a,b,c){if(h.expect_response)if(h.download_stream)a.success(!0);else if("application/futoin+json"===c){if("string"==typeof b)try{b=JSON.parse(b)}catch(d){a.error(f.FutoInError.CommError,"JSON:"+d.message)}i.onMessageResponse(a,h,b)}else i.onDataResponse(a,h,b);else a.success()})})},_member_call_intercept:function(a,b,c,d){var e=c.params,h=Object.keys(e);d.length>h.length?a.error(f.FutoInError.InvokerError,"Unknown parameters"):d.length<c.min_args?a.error(f.FutoInError.InvokerError,"Missing parameters"):d.length<h.length&&(h=h.splice(0,d.length));var i=g.object(h,d);this.call(a,b,i)},_member_call_generate:function(a,b){return function(c){this._member_call_intercept(c,a,b,Array.prototype.slice.call(arguments,1))}},ifaceInfo:function(){return this._iface_info||(this._iface_info=new d(this._raw_info)),this._iface_info},burst:function(){throw new Error(f.FutoInError.InvokerError,"Not Implemented")},bindDerivedKey:function(){throw new Error(f.FutoInError.InvokerError,"Not Implemented")}},b.NativeIface=e},function(a,b){"use strict";function d(a){a=a||{};var b={};b[h.OPT_CALL_TIMEOUT]=3e4,b[h.OPT_X509_VERIFY]=!0,b[h.OPT_PROD_MODE]=!1,b[h.OPT_COMM_CONFIG_CB]=null,j.defaults(a,b),this.options=a}var e,f=c(3),g=f.FutoInError,h=f.Options,i=c(8),j=c(10);if(i){var k=require;e=k("./node_comms")}else e=c(2);b=a.exports=function(b){return new a.exports.SimpleCCMImpl(b)},d.prototype={onRegister:function(a,b){b.funcs={},b.inherits=[],b.constraints={}},createMessage:function(a,b,c){var d=b.info,e={f:d.iface+":"+d.version+":"+b.name,p:c,forcersp:!0};null!==d.creds&&"master"!==d.creds&&(e.sec=d.creds),a.success(e)},onMessageResponse:function(a,b,c){"e"in c?a.error(c.e,c.edesc):a.success(c.r)},onDataResponse:function(a,b,c){a.success(c)},perfomHTTP:function(a,b,c){var d=b.native_iface;"_httpcomms"in d||(d._httpcomms=new e.HTTPComms),d._httpcomms.perform(a,b,c)},perfomWebSocket:function(a,b,c){var d=b.native_iface;"_wscomms"in d||(d._wscomms=new e.WSComms),d._wscomms.perform(a,b,c)},perfomUNIX:function(a,b,c){a.error(g.InvokerError,"Not Implemented")}},b.SimpleCCMImpl=d},function(a){"use strict";var b,d,e=c(3),f=e.FutoInError,g=c(8),h=c(10);if(g){var i=require;b=i("fs"),d=i("request")}var j={standard_errors:{UnknownInterface:!0,NotSupportedVersion:!0,NotImplemented:!0,Unauthorized:!0,InternalError:!0,InvalidRequest:!0,DefenseRejected:!0,PleaseReauth:!0,SecurityError:!0},loadSpec:function(a,c,e){var h=null;a.forEach(e,function(a,e,f){var i=c.iface+"-"+c.version+"-iface.json";a.add(function(a){if("string"==typeof f&&g){var c=f+"/"+i,e=function(b){if(a){try{return f=JSON.parse(b),f._just_loaded=!0,void a.success()}catch(c){}try{a["continue"]()}catch(c){}}};"http"===c.substr(0,4)?d(c,function(a,b,c){e(c)}):b.readFile(c,{encoding:"utf8"},function(a,b){e(b)}),a.setCancel(function(b){a=null})}}).add(function(a){if("string"==typeof f&&!g){var b=f+"/"+i,c=new XMLHttpRequest;c.onreadystatechange=function(){if(this.readyState===this.DONE){var b=this.responseText;if(b)try{return f=JSON.parse(b),f._just_loaded=!0,void a.success()}catch(c){}try{a["continue"]()}catch(d){}}},c.open("GET",b,!0),c.send(),a.setCancel(function(a){c.abort()})}}).add(function(a){"object"==typeof f&&f.iface===c.iface&&f.version===c.version&&"funcs"in f&&(h=f,a["break"]())})}).add(function(a){null===h&&a.error(f.InternalError,"Failed to load valid spec for "+c.iface+":"+c.version),j.parseSpec(a,c,e,h)})},parseSpec:function(a,b,c,d){if(d.ftn3rev){var g=d.ftn3rev.match(e._ifacever_pattern);null===g&&a.error(f.InternalError,"Invalid ftn3rev field"),"1"===g[5]?!b._invoker_use&&g[6]>1&&a.error(f.InternalError,"Not supported FTN3 revision for Executor"):a.error(f.InternalError,"Not supported FTN3 revision")}else(d.imports||d.types)&&a.error(f.InternalError,"Missing ftn3rev field when FTN3 v1.1 features are used");d._just_loaded?(b.funcs=d.funcs||{},b.types=d.types||{}):(b.funcs=h.cloneDeep(d.funcs||{}),b.types=h.cloneDeep(d.types||{}));var i,k;for(var l in b.funcs){if(i=b.funcs[l],i.min_args=0,"params"in i){var m=i.params;"object"!=typeof m&&a.error(f.InternalError,"Invalid params object");for(k in m){var n=m[k];"object"!=typeof n&&a.error(f.InternalError,"Invalid param object"),"type"in n||a.error(f.InternalError,"Missing type for params"),"default"in n||(i.min_args+=1)}}else i.params={};if(i.expect_result=!1,"result"in i){var o=i.result;"object"!=typeof o&&a.error(f.InternalError,"Invalid result object");for(var p in o){var q=o[p];"object"!=typeof q&&a.error(f.InternalError,"Invalid resultvar object"),"type"in q||a.error(f.InternalError,"Missing type for result"),i.expect_result=!0}}else i.result={};if("rawupload"in i||(i.rawupload=!1),"rawresult"in i||(i.rawresult=!1),i.rawresult&&(i.expect_result=!0),"throws"in i){i.expect_result||a.error(f.InternalError,'"throws" without result');var r=i["throws"];Array.isArray(r)||a.error(f.InternalError,'"throws" is not array'),i["throws"]=h.object(r,r)}else i["throws"]={}}if("requires"in d){var s=d.requires;Array.isArray(s)||a.error(f.InternalError,'"requires" is not array'),b.constraints=h.object(s,s)}else b.constraints={};if(b.inherits=[],"inherit"in d){var t=d.inherit.match(e._ifacever_pattern);null===t&&a.error(f.InvokerError,"Invalid inherit ifacever: "+d.inherit);var u={};u.iface=t[1],u.version=t[4],j.loadSpec(a,u,c),a.add(function(a){j._parseInherit(a,b,c,d,u)})}"imports"in d?(b.imports=d.imports.slice(),a.forEach(d.imports,function(a,g,h){var i=h.match(e._ifacever_pattern);null===i&&a.error(f.InvokerError,"Invalid import ifacever: "+h);var k={};k.iface=i[1],k.version=i[4],j.loadSpec(a,k,c),a.add(function(a){Array.prototype.push.apply(b.imports,k.imports),j._parseImport(a,b,c,d,k)})})):b.imports=[]},_parseInherit:function(a,b,c,d,e){var g,i;for(var j in e.types)j in b.types?a.error(f.InternalError,"Iface type redifintion: "+j):b.types[j]=e.types[j];for(var k in e.funcs){var l=e.funcs[k];if(k in b.funcs){var m=l.params,n=b.funcs[k].params,o=Object.keys(m),p=Object.keys(n);for(p.length<o.length&&a.error(f.InternalError,"Invalid param count for '"+k+"'"),g=0;g<o.length;++g)i=o[g],i!==p[g]&&a.error(f.InternalError,"Invalid param order for '"+k+"/"+i+"'"),m[i].type!==n[i].type&&a.error(f.InternalError,"Param type mismatch '"+k+"/"+i+"'");for(;g<p.length;++g)i=p[g],i in m||"default"in n[i]||null===n[i]||a.error(f.InternalError,"Missing default for '"+k+"/"+i+"'");l.rawresult!==b.funcs[k].rawresult&&a.error(f.InternalError,"'rawresult' flag mismatch for '"+k+"'"),l.rawupload&&!b.funcs[k].rawupload&&a.error(f.InternalError,"'rawupload' flag is missing for '"+k+"'")}else b.funcs[k]=l}b.inherits.push(d.inherit),b.inherits=b.inherits.concat(e.inherits),h.difference(Object.keys(e.constraints),d.requires).length&&a.error(f.InternalError,"Missing constraints from inherited")},_parseImport:function(a,b,c,d,e){for(var f in e.types)f in b.types||(b.types[f]=e.types[f]);for(var g in e.funcs)g in b.funcs||(b.funcs[g]=e.funcs[g])},checkConsistency:function(a,b){},checkType:function(a,b,c,d){switch(b){case"any":return!0;case"boolean":case"string":case"number":return typeof c===b;case"map":return"object"==typeof c;case"integer":return"number"==typeof c&&(0|c)===c;case"array":return c instanceof Array;default:if(!("types"in a&&b in a.types))return!1}if(b in a.types){var e=a.types[b];d=d||{};var g=e.type;if(g in d)throw console&&console.log("[ERROR] Custom type recursion: "+e),new Error(f.InternalError);if(d[b]=!0,!this.checkType(a,g,c,d))return!1;switch(g){case"integer":case"number":return"min"in e&&c<e.min?!1:"max"in e&&c>e.max?!1:!0;case"string":if("regex"in e){var h;return"_comp_regex"in a?(h={},a._comp_regex=h):h=a._comp_regex,b in h&&(h[b]=new RegExp(e.regex)),null!==c.match(h[b])}return!0;case"array":var i=c.length;if("minlen"in e&&i<e.minlen)return!1;if("maxlen"in e&&i>e.maxlen)return!1;if("elemtype"in e)for(var j=0;i>j;++j)if(!this.checkType(a,e.elemtype,c,[]))return!1;return!0;case"map":if("fields"in e){var k=e.fields;for(var l in k){var m=k[l];if(!m.optional&&l in c)return!1;if(!this.checkType(a,m.type,c[l],[]))return!1}}return!0}}return!1},checkParameterType:function(a,b,c,d,e){j.checkType(b,d,e)||a.error(f.InvalidRequest,"Type mismatch for parameter: "+c)},checkResultType:function(a,b,c,d,e){j.checkType(b,d,e)||a.error(f.InvalidRequest,"Type mismatch for result: "+c)},checkFutoInType:function(a,b,c,d){j.checkType({},b,d)||a.error(f.InvalidRequest,"Type mismatch for parameter: "+c)}};a.exports=j},function(a){a.exports=!1;try{a.exports="[object process]"===Object.prototype.toString.call(e.process)}catch(b){}},function(b){b.exports=a},function(a){a.exports=b},function(a){(function(){"use strict";function b(){}function c(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function e(a){return function(){return this[a].apply(this,arguments)}}var f=b.prototype,g=this,h=g.EventEmitter;f.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},f.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},f.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},f.addListener=function(a,b){var d,e=this.getListenersAsObject(a),f="object"==typeof b;for(d in e)e.hasOwnProperty(d)&&-1===c(e[d],b)&&e[d].push(f?b:{listener:b,once:!1});return this},f.on=e("addListener"),f.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},f.once=e("addOnceListener"),f.defineEvent=function(a){return this.getListeners(a),this},f.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},f.removeListener=function(a,b){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=c(f[e],b),-1!==d&&f[e].splice(d,1));return this},f.off=e("removeListener"),f.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},f.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},f.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},f.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},f.removeAllListeners=e("removeEvent"),f.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},f.trigger=e("emitEvent"),f.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},f.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},f._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},f._getEvents=function(){return this._events||(this._events={})},b.noConflict=function(){return g.EventEmitter=h,b},"function"==typeof d&&d.amd?d(function(){return b}):"object"==typeof a&&a.exports?a.exports=b:g.EventEmitter=b}).call(this)}],c(1)});